<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>maipaaaaaaaaanðŸ”‹âš¡</title>
  <style>
    :root{font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;}
    body{max-width:920px;margin:28px auto;padding:18px;background:#fafafa;color:#111}
    header{display:flex;align-items:center;gap:12px}
    h1{font-size:20px;margin:0}
    .card{background:#fff;border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(12,12,12,.06);margin-top:12px}
    textarea{width:100%;min-height:140px;padding:12px;border-radius:8px;border:1px solid #e6e6e6;resize:vertical;font-size:15px}
    .row{display:flex;gap:12px;margin-top:10px;flex-wrap:wrap}
    .btn{padding:8px 12px;border-radius:8px;border:0;background:#111;color:#fff;cursor:pointer}
    .muted{color:#666;font-size:13px}
    label{display:flex;gap:8px;align-items:center}
    pre{white-space:pre-wrap;word-break:break-word;background:#f6f6f6;padding:12px;border-radius:8px}
    footer{margin-top:18px;color:#666;font-size:13px}
  </style>
</head>
<body>
  <header>
    <div>
      <h1>maipaaaaaaaaanðŸ”‹âš¡</h1>
      <div class="muted">Masukkan teks -> hasil otomatis. Aturan tetap: <code>K â†’ P</code>, <code>ng â†’ m</code>, plus aturan kata & huruf tambahan.</div>
    </div>
  </header>

  <div class="card">
    <strong>Aturan (tetap):</strong>
    <div class="row" style="margin-top:8px">
      <!-- Fixed mapping: K -> P (permanent). Hidden input keeps code compatibility. -->
      <input type="hidden" id="kMap" value="p" />
      <div class="muted">Mapping untuk huruf <code>K</code>: <strong>K â†’ P</strong> (tetap). <strong>ng â†’ m</strong> aktif.</div>

      <label title="Aktifkan penggantian 'ng' â†’ 'm'">
        <input type="checkbox" id="ngToggle" checked /> Ganti <code>ng</code> â†’ <code>m</code>
      </label>

      <label title="Case sensitive behavior">
        <input type="checkbox" id="preserveCase" checked /> Pertahankan kapitalisasi
      </label>
    </div>

    <div style="margin-top:12px">
      <textarea id="inputText" placeholder="Apa yang sedang anda pikirkan?"></textarea>
</textarea>
    </div>

    <div class="row">
      <button class="btn" id="transformBtn">Transform sekarang</button>
      <button class="btn" id="copyBtn">Salin hasil</button>
      <button class="btn" id="downloadBtn">Unduh .txt</button>
      <div style="flex:1" class="muted">Hasil akan muncul langsung di bawah saat transformasi dijalankan.</div>
    </div>

    <div style="margin-top:12px">
      <strong>Hasil:</strong>
      <pre id="outputText"></pre>
    </div>

    <footer>
      Catatan: Aturan saat ini tetap â€” <code>K â†’ P</code>, <code>ng â†’ m</code>, plus penggantian kata: <code>terimakasihâ†’timapaci</code>, <code>kamuâ†’kamuna</code>, <code>akuâ†’akuna</code>, <code>nyaâ†’na</code>, dan huruf <code>lâ†’n</code>. Kapitalisasi dipertahankan bila opsi dicentang.
    </footer>
  </div>

  <script>
  // Utility: preserve capitalization per-letter
  function mapCharWithCase(origChar, mappedChar, preserve){
    if(!preserve) return mappedChar;
    if(origChar.toUpperCase() === origChar && origChar.toLowerCase() !== origChar) {
      return mappedChar.toUpperCase();
    }
    if(origChar.toLowerCase() === origChar && origChar.toUpperCase() !== origChar) {
      return mappedChar.toLowerCase();
    }
    return mappedChar;
  }

  // helper for multi-word case preservation
  function isAllUpper(s){ return !!s && s.toUpperCase() === s && s.toLowerCase() !== s; }
  function isCapitalized(s){ return !!s && s[0] === s[0].toUpperCase() && s.slice(1) === s.slice(1).toLowerCase(); }
  function preserveMultiCase(orig, repl){
    if(isAllUpper(orig)) return repl.toUpperCase();
    if(isCapitalized(orig)) return repl.charAt(0).toUpperCase() + repl.slice(1).toLowerCase();
    return repl.toLowerCase();
  }

  // preserve case for digraph â†’ single-char replacement (ngâ†’m)
  function preservePairToSingle(origPair, repl, preserve){
    if(!preserve) return repl;
    if(origPair[0] && origPair[0] === origPair[0].toUpperCase()) return repl.toUpperCase();
    return repl.toLowerCase();
  }

  function transformText(text, opts){
    const preserve = !!opts.preserveCase;

    // Multi replacements â€” 'kak' protected
    const multi = [
      ['kak','kak'],            // protected keyword
      ['lucu','lucu'],            // protected keyword
      ['terimakasih','timapaci'],
      ['kamu','kamuna'],
      ['aku','akuna'],
      ['nya','na']              // but only when standalone
    ];

    const tokenMap = {};
    let tokenIndex = 0;

    // MULTI Replace with word-boundaries
    let s = text;
    for(const [from,to] of multi){
      const esc = from.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
      const re = new RegExp('\\b' + esc + '\\b', 'gi');

      s = s.replace(re, (m)=>{
        const repl = preserve ? preserveMultiCase(m, to) : to;
        const token = 'Â§Â§' + (tokenIndex++) + 'Â§Â§';
        tokenMap[token] = repl;
        return token;
      });
    }

    // CHARACTER-level rules
    let out = '';
    for(let i=0;i<s.length;i++){
      const ch = s[i];
      const next = s[i+1] || '';

      // token detection
      if(ch === 'Â§' && s.slice(i).match(/^Â§Â§\d+Â§Â§/)){
        const match = s.slice(i).match(/^Â§Â§\d+Â§Â§/)[0];
        out += match;
        i += match.length - 1;
        continue;
      }

      // ng â†’ m
      if(opts.ngEnabled && (ch.toLowerCase() === 'n' && next.toLowerCase() === 'g')){
        const pair = ch + next;
        out += preservePairToSingle(pair, 'm', preserve);
        i++;
        continue;
      }

      // k â†’ p
      if(ch.toLowerCase() === 'k'){
        out += mapCharWithCase(ch, opts.kMap.toLowerCase(), preserve);
        continue;
      }

      // l â†’ n
      if(ch.toLowerCase() === 'l'){
        out += mapCharWithCase(ch, 'n', preserve);
        continue;
      }

      out += ch;
    }

    // restore protected tokens
    for(const token in tokenMap){
      out = out.split(token).join(tokenMap[token]);
    }

    return out;
  }

  // DOM
  const input = document.getElementById('inputText');
  const output = document.getElementById('outputText');
  const kMap = document.getElementById('kMap');
  const ngToggle = document.getElementById('ngToggle');
  const preserveCase = document.getElementById('preserveCase');

  function runTransform(){
    const opts = {kMap:kMap.value || 'p', ngEnabled:ngToggle.checked, preserveCase: preserveCase.checked};
    output.textContent = transformText(input.value, opts);
  }

  document.getElementById('transformBtn').addEventListener('click', runTransform);
  input.addEventListener('input', runTransform);
  ngToggle.addEventListener('change', runTransform);
  preserveCase.addEventListener('change', runTransform);

  document.getElementById('copyBtn').addEventListener('click', async ()=>{
    try{
      await navigator.clipboard.writeText(output.textContent);
      alert('Tersalin!');
    }catch(e){ alert('Gagal menyalin.'); }
  });

  document.getElementById('downloadBtn').addEventListener('click', ()=>{
    const blob = new Blob([output.textContent], {type:'text/plain'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'hasil-transform.txt';
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  });

  runTransform();
</script>
</body>
</html>
